# database
docker run --rm -it postgres:15.1-alpine psql -U user-dcare-rest-service -W eVWDdnbFuOOL -h db.shuttle.rs -p 5432 -d db-dcare-rest-service
or
run `docker exec -it shuttle_dcare-rest-service_shared_postgres bash` to find psql

run `psql -U postgres` into cli
```sh
psql (11.16 (Debian 11.16-1.pgdg90+1))
Type "help" for help.

postgres=# \c postgres
You are now connected to database "postgres" as user "postgres".
postgres=# \dt
              List of relations
 Schema |      Name       | Type  |  Owner
--------+-----------------+-------+----------
 public | accessories     | table | postgres
 public | departments     | table | postgres
 public | faults          | table | postgres
 public | models          | table | postgres
 public | order_histories | table | postgres
 public | orders          | table | postgres
 public | sessions        | table | postgres
 public | status          | table | postgres
 public | titles          | table | postgres
 public | users           | table | postgres
(10 rows)

postgres=#
postgres=# select * from users;
 id | account |                                            password                                            | permission | username | worker_id | title_id | department_id |  phone  | email |           create_at           | login_at
----+---------+------------------------------------------------------------------------------------------------+------------+----------+-----------+----------+---------------+---------+-------+-------------------------------+----------
  3 | aaa     | $pbkdf2-sha256$i=10000,l=32$AqveGr2a6vcMiZ+pqHC4/A$uFGUzt9wC9E1G5pqd30j2bykOvk793k8V3+2leL0TTA | 10100000   | aaa      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:41:50.368915+00 |
  4 | bbb     | $pbkdf2-sha256$i=10000,l=32$h0sJW3jnhmD1HqkiOnW2GA$4tfFHiKKiXub0OeXAa9DdhCrPUepwzwjjUhhQPO/+zg | 10100000   | bbb      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:42:27.431591+00 |
  5 | ccc     | $pbkdf2-sha256$i=10000,l=32$A0BgZG/WYqZA74hdubWn4A$n2GR7jYsbgqTziB8Atix3EcybpiamfjknyaODd6xWew | 10100000   | ccc      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:42:46.774951+00 |
(3 rows)

postgres=# select * from orders;
 id | issue_at | department_id | contact_id | customer_name | customer_phone | customer_address | model_id | purchase_at | accessory_id1 | accessory_id2 | accessory_other | appearance | appearance_other | service | fault_id1 | fault_id2 | fault_other | photo_url | remark |
 cost | prepaid_free | status_id | servicer_id | maintainer_id
----+----------+---------------+------------+---------------+----------------+------------------+----------+-------------+---------------+---------------+-----------------+------------+------------------+---------+-----------+-----------+-------------+-----------+--------+
------+--------------+-----------+-------------+---------------
(0 rows)

postgres=# select * from departments;
 id |  name  | address
----+--------+---------
  1 | ff1111 |
(1 row)

postgres=#
postgres=# select * from orders;
 id |          issue_at           | department_id | contact_id | customer_name | customer_phone | customer_address | model_id | purchase_at | accessory_id1 | accessory_id2 | accessory_other | appearance | appearance_other | service | fault_id1 | fault_id2 | fault_other | p
hoto_url | remark | cost | prepaid_free | status_id | servicer_id | maintainer_id
----+-----------------------------+---------------+------------+---------------+----------------+------------------+----------+-------------+---------------+---------------+-----------------+------------+------------------+---------+-----------+-----------+-------------+--
---------+--------+------+--------------+-----------+-------------+---------------
  2 | 2023-01-13 01:50:52.6624+00 |             1 |          3 |               | 0900001001     |                  |        2 |             |             1 |             1 |                 | 10000000   |                  |         |         1 |         1 |             |
         |        |      |              |         2 |             |
(1 row)

postgres=# select * from status;
 id |   flow
----+----------
  1 | clean
  2 | ordering
(2 rows)

postgres=# select o.id,o.issue_at,(select username from users u where u.id = o.contact_id) as contact from orders o;
 id |          issue_at           | contact
----+-----------------------------+---------
  2 | 2023-01-13 01:50:52.6624+00 | aaa
(1 row)

postgres=# select o.id,o.issue_at,(select username from users u where u.id = o.contact_id) from orders o;
 id |          issue_at           | username
----+-----------------------------+----------
  2 | 2023-01-13 01:50:52.6624+00 | aaa
(1 row)

postgres=# select o.id,o.issue_at,(select username from users u where u.id = o.contact_id or u.id = o.servicer_id or u.id = o.maintainer_id) from orders o;
 id |          issue_at           | username
----+-----------------------------+----------
  2 | 2023-01-13 01:50:52.6624+00 | aaa
(1 row)

postgres=# select * from orders;
 id |           issue_at            | department_id | contact_id | customer_name | customer_phone | customer_address | model_id | purchase_at | accessory_id1 | accessory_id2 | accessory_other | appearance | appearance_other | service | fault_id1 | fault_id2 | fault_other |
 photo_url | remark | cost | prepaid_free | status_id | servicer_id | maintainer_id
----+-------------------------------+---------------+------------+---------------+----------------+------------------+----------+-------------+---------------+---------------+-----------------+------------+------------------+---------+-----------+-----------+-------------+
-----------+--------+------+--------------+-----------+-------------+---------------
  2 | 2023-01-13 01:50:52.6624+00   |             1 |          3 |               | 0900001001     |                  |        2 |             |             1 |             1 |                 | 10000000   |                  |         |         1 |         1 |             |
           |        |      |              |         2 |             |
  3 | 2023-01-13 01:58:46.405783+00 |             1 |          4 |               | 0900001001     |                  |        2 |             |             1 |             1 |                 | 10000000   |                  |         |         1 |         1 |             |
           |        |      |              |         2 |             |             5
(2 rows)

postgres=# select o.id,o.issue_at,(select username from users u where u.id = o.contact_id or u.id = o.servicer_id or u.id = o.maintainer_id) from orders o;
ERROR:  more than one row returned by a subquery used as an expression
postgres=# select * from users
postgres-# select * from users;
ERROR:  syntax error at or near "select"
LINE 2: select * from users;
        ^
postgres=# select * from users;
 id | account |                                            password                                            | permission | username | worker_id | title_id | department_id |  phone  | email |           create_at           | login_at
----+---------+------------------------------------------------------------------------------------------------+------------+----------+-----------+----------+---------------+---------+-------+-------------------------------+----------
  3 | aaa     | $pbkdf2-sha256$i=10000,l=32$AqveGr2a6vcMiZ+pqHC4/A$uFGUzt9wC9E1G5pqd30j2bykOvk793k8V3+2leL0TTA | 10100000   | aaa      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:41:50.368915+00 |
  4 | bbb     | $pbkdf2-sha256$i=10000,l=32$h0sJW3jnhmD1HqkiOnW2GA$4tfFHiKKiXub0OeXAa9DdhCrPUepwzwjjUhhQPO/+zg | 10100000   | bbb      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:42:27.431591+00 |
  5 | ccc     | $pbkdf2-sha256$i=10000,l=32$A0BgZG/WYqZA74hdubWn4A$n2GR7jYsbgqTziB8Atix3EcybpiamfjknyaODd6xWew | 10100000   | ccc      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:42:46.774951+00 |
(3 rows)

postgres=#
postgres=# select * from orders;
 id |           issue_at           | department_id | contact_id | customer_name | customer_phone | customer_address | model_id | purchase_at | accessory_id1 | accessory_id2 | accessory_other | appearance | appearance_other | service | fault_id1 | fault_id2 | fault_other |
photo_url | remark | cost | prepaid_free | status_id | servicer_id | maintainer_id
----+------------------------------+---------------+------------+---------------+----------------+------------------+----------+-------------+---------------+---------------+-----------------+------------+------------------+---------+-----------+-----------+-------------+-
----------+--------+------+--------------+-----------+-------------+---------------
  1 | 2023-01-13 02:26:29.01121+00 |             1 |          3 |               | 0900001001     |                  |        2 |             |               |               |                 | 10000000   |                  |         |           |           |             |
          |        |      |              |         2 |             |
(1 row)

postgres=#
postgres=# select * from orders;
 id | issue_at | department_id | contact_id | customer_name | customer_phone | customer_address | model_id | purchase_at | accessory_id1 | accessory_id2 | accessory_other | appearance | appearance_other | service | fault_id1 | fault_id2 | fault_other | photo_url | remark |
 cost | prepaid_free | status_id | servicer_id | maintainer_id
----+----------+---------------+------------+---------------+----------------+------------------+----------+-------------+---------------+---------------+-----------------+------------+------------------+---------+-----------+-----------+-------------+-----------+--------+
------+--------------+-----------+-------------+---------------
(0 rows)

postgres=# select * from users;
 id | account |                                            password                                            | permission | username | worker_id | title_id | department_id |  phone  | email |           create_at           | login_at
----+---------+------------------------------------------------------------------------------------------------+------------+----------+-----------+----------+---------------+---------+-------+-------------------------------+----------
  3 | aaa     | $pbkdf2-sha256$i=10000,l=32$AqveGr2a6vcMiZ+pqHC4/A$uFGUzt9wC9E1G5pqd30j2bykOvk793k8V3+2leL0TTA | 10100000   | aaa      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:41:50.368915+00 |
  4 | bbb     | $pbkdf2-sha256$i=10000,l=32$h0sJW3jnhmD1HqkiOnW2GA$4tfFHiKKiXub0OeXAa9DdhCrPUepwzwjjUhhQPO/+zg | 10100000   | bbb      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:42:27.431591+00 |
  5 | ccc     | $pbkdf2-sha256$i=10000,l=32$A0BgZG/WYqZA74hdubWn4A$n2GR7jYsbgqTziB8Atix3EcybpiamfjknyaODd6xWew | 10100000   | ccc      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:42:46.774951+00 |
(3 rows)

postgres=# select * from users order by id desc limit 1
postgres-# select * from users order by id desc limit 1;
ERROR:  syntax error at or near "select"
LINE 2: select * from users order by id desc limit 1;
        ^
postgres=# select * from users order by id desc limit 1
select * from users order by id limit 1;
ERROR:  syntax error at or near "select"
LINE 2: select * from users order by id limit 1;
        ^
postgres=# select * from users order by id desc limit 1
select * from users by id limit 1;
ERROR:  syntax error at or near "select"
LINE 2: select * from users by id limit 1;
        ^
postgres=# select * from users order by id desc limit 1
select * from users order by id limit 1;
ERROR:  syntax error at or near "select"
LINE 2: select * from users order by id limit 1;
        ^
postgres=# select * from users;
 id | account |                                            password                                            | permission | username | worker_id | title_id | department_id |  phone  | email |           create_at           | login_at
----+---------+------------------------------------------------------------------------------------------------+------------+----------+-----------+----------+---------------+---------+-------+-------------------------------+----------
  3 | aaa     | $pbkdf2-sha256$i=10000,l=32$AqveGr2a6vcMiZ+pqHC4/A$uFGUzt9wC9E1G5pqd30j2bykOvk793k8V3+2leL0TTA | 10100000   | aaa      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:41:50.368915+00 |
  4 | bbb     | $pbkdf2-sha256$i=10000,l=32$h0sJW3jnhmD1HqkiOnW2GA$4tfFHiKKiXub0OeXAa9DdhCrPUepwzwjjUhhQPO/+zg | 10100000   | bbb      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:42:27.431591+00 |
  5 | ccc     | $pbkdf2-sha256$i=10000,l=32$A0BgZG/WYqZA74hdubWn4A$n2GR7jYsbgqTziB8Atix3EcybpiamfjknyaODd6xWew | 10100000   | ccc      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:42:46.774951+00 |
(3 rows)

postgres=# select * from users limit 1;
 id | account |                                            password                                            | permission | username | worker_id | title_id | department_id |  phone  | email |           create_at           | login_at
----+---------+------------------------------------------------------------------------------------------------+------------+----------+-----------+----------+---------------+---------+-------+-------------------------------+----------
  3 | aaa     | $pbkdf2-sha256$i=10000,l=32$AqveGr2a6vcMiZ+pqHC4/A$uFGUzt9wC9E1G5pqd30j2bykOvk793k8V3+2leL0TTA | 10100000   | aaa      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:41:50.368915+00 |
(1 row)

postgres=# select * from users order by id desc limit 1;
 id | account |                                            password                                            | permission | username | worker_id | title_id | department_id |  phone  | email |           create_at           | login_at
----+---------+------------------------------------------------------------------------------------------------+------------+----------+-----------+----------+---------------+---------+-------+-------------------------------+----------
  5 | ccc     | $pbkdf2-sha256$i=10000,l=32$A0BgZG/WYqZA74hdubWn4A$n2GR7jYsbgqTziB8Atix3EcybpiamfjknyaODd6xWew | 10100000   | ccc      | aa00002   |        1 |             1 | 9999999 | cc@dd | 2023-01-13 01:42:46.774951+00 |
(1 row)

postgres=#

```

# API

## departments

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=209984773393384026659480751265137468669' http://127.0.0.1:8000/api/v1/department -s | jq
```json
{
  "code": 200,
  "departments": [
    {
      "shorten": "ADM",
      "store_name": "總部",
      "owner": null,
      "telephone": null,
      "address": null,
      "type_id": "總部"
    }
  ]
}

```

```sh
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=209984773393384026659480751265137468669' http://127.0.0.1:8000/api/v1/department -s -d '{"shorten":"BM"}'
{"code":200,"message":"department2 create success"}⏎
```

```sh
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=209984773393384026659480751265137468669' http://127.0.0.1:8000/api/v1/department -s | jq
{
  "code": 200,
  "departments": [
    {
      "shorten": "ADM",
      "store_name": "總部",
      "owner": null,
      "telephone": null,
      "address": null,
      "type_id": "總部"
    },
    {
      "shorten": "BM",
      "store_name": null,
      "owner": null,
      "telephone": null,
      "address": null,
      "type_id": null
    }
  ]
}
```

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=209984773393384026659480751265137468669' http://127.0.0.1:8000/api/v1/department/BM -s -X PUT -d '{"store_name":"taiwan cloud forest donan","type_id":"營業點"}'
{"code":200,"message":"department2 update success"}⏎

│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=209984773393384026659480751265137468669' http://127.0.0.1:8000/api/v1/department -s | jq
{
  "code": 200,
  "departments": [
    {
      "shorten": "ADM",
      "store_name": "總部",
      "owner": null,
      "telephone": null,
      "address": null,
      "type_id": "總部"
    },
    {
      "shorten": "BM",
      "store_name": "taiwan cloud forest donan",
      "owner": null,
      "telephone": null,
      "address": null,
      "type_id": "營業點"
    }
  ]
}

│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=209984773393384026659480751265137468669' http://127.0.0.1:8000/api/v1/department/BM -s | jq
{
  "code": 200,
  "department": {
    "create_at": "2023-01-19T03:26:00.309593Z",
    "update_at": "2023-01-19T03:31:27.949280Z",
    "shorten": "BM",
    "store_name": "taiwan cloud forest donan",
    "owner": null,
    "telephone": null,
    "address": null,
    "type_id": "營業點",
    "parents": null,
    "childs": null
  }
}

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/department -s -d '{"shorten":"JSHall2","store_name":"taiwan jshall2 in taichuang","type_id":"維保中心","parents":["BM"]}'
{"code":200,"message":"department5 create success"}⏎
┌─────────────────────────────────────────
│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/department/BM -s | jq
{
  "code": 200,
  "department": {
    "create_at": "2023-01-19T03:46:37.532857Z",
    "update_at": null,
    "shorten": "BM",
    "store_name": "taiwan cloud forest donan",
    "owner": null,
    "telephone": null,
    "address": null,
    "type_id": "營業點",
    "parents": [
      "ADM"
    ],
    "childs": [
      "JSHall",
      "JSHall2"
    ]
  }
}

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/department/JSHall -s | jq
{
  "code": 200,
  "department": {
    "create_at": "2023-01-19T05:38:55.809034Z",
    "update_at": null,
    "shorten": "JSHall",
    "store_name": "taiwan jshall in hsinchu",
    "owner": null,
    "telephone": null,
    "address": null,
    "type_id": "維保中心",
    "parents": [
      "BM"
    ],
    "childs": []
  }
}

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/department -s | jq
{
  "code": 200,
  "departments": [
    {
      "shorten": "ADM",
      "store_name": "總部",
      "owner": null,
      "telephone": null,
      "address": null,
      "type_id": "總部"
    },
    {
      "shorten": "BM",
      "store_name": "taiwan cloud forest donan",
      "owner": null,
      "telephone": null,
      "address": null,
      "type_id": "營業點"
    },
    {
      "shorten": "JSHall",
      "store_name": "taiwan jshall in hsinchu",
      "owner": null,
      "telephone": null,
      "address": null,
      "type_id": "維保中心"
    },
    {
      "shorten": "JSHall2",
      "store_name": "taiwan jshall2 in taichuang",
      "owner": null,
      "telephone": null,
      "address": null,
      "type_id": "維保中心"
    }
  ]
}


└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/department/JSHall -X PUT -d '{"parents":["ADM"]}'
{"code":200,"message":"department4 update success"}⏎
┌─────────────────────────────────────────
│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/department/JSHall -s | jq
{
  "code": 200,
  "department": {
    "create_at": "2023-01-19T05:38:55.809034Z",
    "update_at": "2023-01-19T05:42:55.577912Z",
    "shorten": "JSHall",
    "store_name": "taiwan jshall in hsinchu",
    "owner": null,
    "telephone": null,
    "address": null,
    "type_id": "維保中心",
    "parents": [
      "ADM",
      "BM"
    ],
    "childs": []
  }
}

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/department/ADM -s | jq
{
  "code": 200,
  "department": {
    "create_at": "2023-01-19T03:43:08.311421Z",
    "update_at": null,
    "shorten": "ADM",
    "store_name": "總部",
    "owner": null,
    "telephone": null,
    "address": null,
    "type_id": "總部",
    "parents": [],
    "childs": [
      "BM",
      "JSHall"
    ]
  }
}

curl -H 'Content-Type: application/json' --cookie 'user_token=61005067848981703473443886197130317173' http://127.0.0.1:8000/api/v1/department/org/BM\?child=JSHall2 -X DELETE
{"code":200,"message":"delete department/org child success"}⏎                                                                                                                                   yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
curl -H 'Content-Type: application/json' --cookie 'user_token=61005067848981703473443886197130317173' http://127.0.0.1:8000/api/v1/department/org/BM -s | jq
{
    "code": 400,
    "org": {
        "current": "BM",
        "parents": [
            "ADM"
        ],
        "childs": []
    }
}

curl -H 'Content-Type: application/json' --cookie 'user_token=61005067848981703473443886197130317173' http://127.0.0.1:8000/api/v1/department/org/JSHall2 -s | jq
{
    "code": 400,
    "org": {
        "current": "JSHall2",
        "parents": [],
        "childs": []
    }
}


curl -H 'Content-Type: application/json' --cookie 'user_token=133538013044630618834801819609124361137' http://127.0.0.1:8000/api/v1/department -s -d '{"shorten":"JSHall2","store_name":"taiwan
jshall2 in taichuang","type_id":"維保中心","parents":["ADM"]}'
{"code":200,"message":"department2 create success"}⏎                                                                                                                                            yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
curl -H 'Content-Type: application/json' --cookie 'user_token=3536642166546380728190240069996578492' http://127.0.0.1:8000/api/v1/department -s | jq
{
    "code": 200,
        "departments": [
        {
            "create_at": "2023-01-20T05:15:47.361467Z",
            "update_at": null,
            "shorten": "JSHall2",
            "store_name": "taiwan jshall2 in taichuang",
            "owner": null,
            "telephone": null,
            "address": null,
            "type_id": "維保中心",
            "parents": [
                "ADM"
            ],
            "childs": []
        },
        {
            "create_at": "2023-01-20T05:13:57.033102Z",
            "update_at": null,
            "shorten": "ADM",
            "store_name": "總部",
            "owner": null,
            "telephone": null,
            "address": null,
            "type_id": "總部",
            "parents": [],
            "childs": [
                "JSHall2"
            ]
        }
    ]
}

curl -H 'Content-Type: application/json' --cookie 'user_token=293235454743220836731261381085443788318' http://127.0.0.1:8000/api/v1/department -s | jq
{
    "code": 200,
        "departments": [
        {
            "create_at": "2023-01-20T06:57:21.845226Z",
            "update_at": null,
            "shorten": "BB",
            "store_name": "my BB",
            "owner": null,
            "telephone": null,
            "address": null,
            "type_id": "維保中心",
            "parents": [
                "JSHall2"
            ],
            "childs": []
        },
        {
            "create_at": "2023-01-20T06:56:18.978506Z",
            "update_at": null,
            "shorten": "JSHall2",
            "store_name": "taiwan jshall2 in taichuang",
            "owner": null,
            "telephone": null,
            "address": null,
            "type_id": "維保中心",
            "parents": [
                "ADM"
            ],
            "childs": [
                "BB"
            ]
        },
        {
            "create_at": "2023-01-20T05:50:57.771764Z",
            "update_at": null,
            "shorten": "ADM",
            "store_name": "總部",
            "owner": null,
            "telephone": null,
            "address": null,
            "type_id": "總部",
            "parents": [],
            "childs": [
                "JSHall2"
            ]
        }
    ]
}
yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
curl -H 'Content-Type: application/json' --cookie 'user_token=293235454743220836731261381085443788318' http://127.0.0.1:8000/api/v1/department/JSHall2 -s -X DELETE
{"code":200,"message":"delete success"}⏎                                                                                                                                                        yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
yellow@LAPTOP-AA8VDMLU ~/s/axum-shuttle-postgres-authentication-demo (dcare-rest-service)>
curl -H 'Content-Type: application/json' --cookie 'user_token=293235454743220836731261381085443788318' http://127.0.0.1:8000/api/v1/department -s | jq
{
    "code": 200,
        "departments": [
        {
            "create_at": "2023-01-20T06:57:21.845226Z",
            "update_at": null,
            "shorten": "BB",
            "store_name": "my BB",
            "owner": null,
            "telephone": null,
            "address": null,
            "type_id": "維保中心",
            "parents": [],
            "childs": []
        },
        {
            "create_at": "2023-01-20T05:50:57.771764Z",
            "update_at": null,
            "shorten": "ADM",
            "store_name": "總部",
            "owner": null,
            "telephone": null,
            "address": null,
            "type_id": "總部",
            "parents": [],
            "childs": []
        }
    ]
}

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=306333113601657959018076325298618669536' http://127.0.0.1:8000/api/v1/department -s -d '{"shorten":"JSHall2","store_name":"taiwan jshall2 in taichuang","type_mask":{"storage":[2],"nbits":8},"parents":["ADM"]}'
{"code":200,"message":"department2 create success"}⏎
┌─────────────────────────────────────────
│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' http://127.0.0.1:8000/api/v1/department -s | jq
{
  "code": 200,
  "departments": [
    {
      "create_at": "2023-01-31T02:41:30.088419Z",
      "update_at": null,
      "shorten": "JSHall2",
      "store_name": "taiwan jshall2 in taichuang",
      "owner": null,
      "telephone": null,
      "address": null,
      "type_mask": {
        "storage": [
          2
        ],
        "nbits": 8
      },
      "parents": [
        "ADM"
      ],
      "childs": []
    },
    {
      "create_at": "2023-01-31T02:34:22.678448Z",
      "update_at": null,
      "shorten": "ADM",
      "store_name": "總部",
      "owner": null,
      "telephone": null,
      "address": null,
      "type_mask": {
        "storage": [
          1
        ],
        "nbits": 8
      },
      "parents": [],
      "childs": [
        "JSHall2"
      ]
    }
  ]
}

## users

```sh
└─> curl -H 'Content-Type: application/json' http://127.0.0.1:8000/api/v1/user -d '{"account":"administrator","password":"fy90676855","confirm_password":"fy90676855","permission":{"storage":[1],"nbits":8},"username":"administrator","worker_id":"aa00001","title":"administrator","department":"總部","phone":"0800","email":"admin@fika.com"}'
```

```sh
└─> curl -H 'Content-Type: application/json' http://127.0.0.1:8000/api/v1/login -d '{"account":"administrator","password":"fy90676855"}'
{"code":200,"permission":{"nbits":8,"storage":[1]},"session_key":"user_token","session_value":"209984773393384026659480751265137468669"}⏎
```

```sh
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=209984773393384026659480751265137468669' http://127.0.0.1:8000/api/v1/me -s | jq
{
  "code": 200,
  "user": {
    "account": "administrator",
    "permission": {
      "storage": [
        1
      ],
      "nbits": 8
    },
    "username": "administrator",
    "worker_id": "aa00001",
    "title": "administrator",
    "department": "總部",
    "phone": "0800",
    "email": "admin@fika.com",
    "create_at": "2023-01-19T03:19:11.895186Z",
    "login_at": "2023-01-19T03:21:06.600709Z"
  }
}

```

## orders

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/order -s -d '{"customer_phone":"phone1","brand":"brand1","appearance":{"storage":[2],"nbits":8},"status":"check"}'
{"code":200,"message":"order1 create success"}⏎

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/order -s | jq
{
  "code": 200,
  "orders": [
    {
      "sn": "NN0301190900010",
      "issue_at": "2023-01-19T09:18:18.337990Z",
      "department": null,
      "contact": null,
      "customer_name": null,
      "service": null,
      "cost": null,
      "status": "check",
      "servicer": null,
      "maintainer": null
    }
  ]
}

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/order/NN0301190900010 -s | jq
{
  "code": 200,
  "order": {
    "sn": "NN0301190900010",
    "issue_at": "2023-01-19T09:18:18.337990Z",
    "department": null,
    "contact": null,
    "customer_name": null,
    "customer_phone": "phone1",
    "customer_address": null,
    "brand": "brand1",
    "model": "unknown",
    "purchase_at": null,
    "accessory1": null,
    "accessory2": null,
    "accessory_other": null,
    "appearance": {
      "storage": [
        2
      ],
      "nbits": 8
    },
    "appearance_other": null,
    "service": null,
    "fault1": null,
    "fault2": null,
    "fault_other": null,
    "photo_url": null,
    "remark": null,
    "cost": null,
    "prepaid_free": null,
    "status": "check",
    "servicer": null,
    "maintainer": null
  }
}

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/order/NN0301190900010 -s -X PUT -d '{"department":"taiwan cloud forest donan","status":"cleaning"}'
{"code":200,"message":"order update success - history1"}⏎

│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=254971077791281876651467273292106090338' http://127.0.0.1:8000/api/v1/order/NN0301190900010 -s | jq
{
  "code": 200,
  "order": {
    "sn": "NN0301190900010",
    "issue_at": "2023-01-19T09:18:18.337990Z",
    "department": "taiwan cloud forest donan",
    "contact": null,
    "customer_name": null,
    "customer_phone": "phone1",
    "customer_address": null,
    "brand": "brand1",
    "model": "unknown",
    "purchase_at": null,
    "accessory1": null,
    "accessory2": null,
    "accessory_other": null,
    "appearance": {
      "storage": [
        2
      ],
      "nbits": 8
    },
    "appearance_other": null,
    "service": null,
    "fault1": null,
    "fault2": null,
    "fault_other": null,
    "photo_url": null,
    "remark": null,
    "cost": null,
    "prepaid_free": null,
    "status": "cleaning",
    "servicer": null,
    "maintainer": null
  }
}

└─> curl -H 'Content-Type: application/json' --cookie 'user_token=306333113601657959018076325298618669536' http://127.0.0.1:8000/api/v1/order -s -d '{"customer_phone":"phone2","brand":"brand1","appearance":{"storage":[3],"nbits":8},"status":"check"}'
Failed to deserialize the JSON body into the target type: .: missing field `department` at line 1 column 100⏎
│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=306333113601657959018076325298618669536' http://127.0.0.1:8000/api/v1/order -s -d '{"customer_phone":"phone4","brand":"brand1","appearance":{"storage":[3],"nbits":8},"status":"check","department":"總部"}'
{"code":200,"message":"order7 create success"}⏎
┌─────────────────────────────────────────
│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=306333113601657959018076325298618669536' http://127.0.0.1:8000/api/v1/order -s | jq
{
  "code": 200,
  "orders": [
    {
      "sn": "ADM301310300070",
      "issue_at": "2023-01-31T03:16:29.090719Z",
      "department": "總部",
      "contact": null,
      "customer_name": null,
      "customer_phone": "phone4",
      "service": null,
      "cost": null,
      "status": "check",
      "servicer": null,
      "maintainer": null
    },
    {
      "sn": "JSHall2301310300060",
      "issue_at": "2023-01-31T03:12:16.991002Z",
      "department": "taiwan jshall2 in taichuang",
      "contact": null,
      "customer_name": null,
      "customer_phone": "phone3",
      "service": null,
      "cost": null,
      "status": "check",
      "servicer": null,
      "maintainer": null
    },
    {
      "sn": "JSHall2301310300020",
      "issue_at": "2023-01-31T03:12:00.751834Z",
      "department": "taiwan jshall2 in taichuang",
      "contact": null,
      "customer_name": null,
      "customer_phone": "phone2",
      "service": null,
      "cost": null,
      "status": "check",
      "servicer": null,
      "maintainer": null
    },
    {
      "sn": "NN0301310300010",
      "issue_at": "2023-01-31T03:02:29.220723Z",
      "department": null,
      "contact": null,
      "customer_name": null,
      "customer_phone": "phone1",
      "service": null,
      "cost": null,
      "status": "check",
      "servicer": null,
      "maintainer": null
    }
  ]
}

│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=306333113601657959018076325298618669536' http://127.0.0.1:8000/api/v1/order/JSHall2301310300060 -X PUT -d '{"maintainer":"aaaaaaaa"}'
{"code":400,"message":"maintainer staff not found"}⏎
│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=306333113601657959018076325298618669536' http://127.0.0.1:8000/api/v1/order/JSHall2301310300060 -X PUT -d '{"maintainer":"aaa"}'
{"code":200,"message":"order update success - history1"}⏎
│axum-shuttle-postgres-authentication-demo via 🦀 v1.66.0 is 📦 v0.1.0 on  dcare-rest-service
└─> curl -H 'Content-Type: application/json' --cookie 'user_token=306333113601657959018076325298618669536' http://127.0.0.1:8000/api/v1/order/JSHall2301310300060 -s | jq
{
  "code": 200,
  "order": {
    "sn": "JSHall2301310300060",
    "issue_at": "2023-01-31T03:12:16.991002Z",
    "department": "taiwan jshall2 in taichuang",
    "contact": null,
    "customer_name": null,
    "customer_phone": "phone3",
    "customer_address": null,
    "brand": "brand1",
    "model": "unknown",
    "purchase_at": null,
    "accessory1": null,
    "accessory2": null,
    "accessory_other": null,
    "appearance": {
      "storage": [
        3
      ],
      "nbits": 8
    },
    "appearance_other": null,
    "service": null,
    "fault1": null,
    "fault2": null,
    "fault_other": null,
    "photo_url": null,
    "remark": null,
    "cost": null,
    "prepaid_free": null,
    "status": "check",
    "servicer": null,
    "maintainer": "maintainer"
  }
}
└─> curl -H 'Content-Type: application/json' http://127.0.0.1:8000/api/v1/user/aaa -X DELETE
{"code":400,"message":"reject due to order/JSHall2301310300060 related"}⏎
